{"version":3,"sources":["../src/index.js"],"names":["getBox","elm","getMargins","box","getBoundingClientRect","styles","getComputedStyle","top","window","scrollY","parseInt","marginTop","left","scrollX","marginLeft","width","marginRight","height","marginBottom","fadeOutTween","element","options","from","to","ease","start","node","style","opacity","v","pointerEvents","fadeInTween","styler","values","easings","times","set","pause","hideTween","seek","Math","round","visibility","t","hide","diffRect","a","b","translateY","translateX","scaleY","scaleX","Morph","state","elementFrom","elementTo","elementsCloned","hideElements","fadeInElements","fadeOutElements","isPlaying","timeline","ref","push","progress","fadeIn","willChange","fadeOut","key","go","length","init","get","props","spring","update","x","setState","forEach","morph","original","zIndex","easing","optEasing","target","originalRect","targetRect","originalCloneContainer","document","createElement","originalClone","cloneNode","appendChild","originalStyler","cloneStyler","targetStyler","position","transformOrigin","portalElement","diffStyle","cloneTranslateIn","diffTargetStyles","targetTranslateFLIP","Object","keys","fadeOuts","map","fadeIns","hidesIns","removeChild","renderedChildren","children","back","Children","only","propTypes","object","func","isRequired","shape","restDelta","number","restSpeed","stiffness","mass","damping","defaultProps","global","body"],"mappings":"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","file":"index.js","sourcesContent":["import React, { Component } from 'react';\nimport propTypes from 'prop-types';\nimport keyframe from 'keyframe';\nimport raf from 'raf';\nimport css from 'stylefire/css';\nimport { linear } from 'popmotion/lib/easing';\nimport keyframes from 'popmotion/lib/animations/keyframes';\nimport spring from 'popmotion/lib/animations/spring';\nimport tween from 'popmotion/lib/animations/tween';\nimport value from 'popmotion/lib/reactions/value';\nimport { pipe } from 'popmotion/lib/transformers';\nimport { interpolateObject } from './util';\n\nconst getBox = (elm, { getMargins = false } = {}) => {\n  const box = elm.getBoundingClientRect();\n  const styles = getComputedStyle(elm);\n\n  return {\n    top:\n      box.top +\n      window.scrollY -\n      (getMargins ? parseInt(styles.marginTop, 10) : 0),\n    left:\n      box.left +\n      window.scrollX -\n      (getMargins ? parseInt(styles.marginLeft, 10) : 0),\n    width:\n      box.width +\n      (getMargins\n        ? parseInt(styles.marginLeft, 10) + parseInt(styles.marginRight, 10)\n        : 0),\n    height:\n      box.height +\n      (getMargins\n        ? parseInt(styles.marginTop, 10) + parseInt(styles.marginBottom, 10)\n        : 0),\n  };\n};\n\nconst fadeOutTween = ({ element, options = {} }) =>\n  tween({\n    from: 1,\n    to: 0,\n    ease: linear,\n    ...options,\n  }).start(v => {\n    const node = element;\n    node.style.opacity = v;\n    if (v === 1) node.style.pointerEvents = 'all';\n  });\n\nconst fadeInTween = ({ element, options = {} }) => {\n  const styler = css(element);\n  return keyframes({\n    values: [{ opacity: 0 }, { opacity: 1 }],\n    easings: linear,\n    times: [0.8, 1],\n    ...options,\n  })\n    .start(style => {\n      const node = element;\n\n      styler.set(style);\n\n      if (style.opacity === 1) node.style.pointerEvents = 'all';\n    })\n    .pause();\n};\n\nconst hideTween = ({ element }) => ({\n  seek: pipe(Math.round, t => {\n    const node = element;\n\n    node.style.visibility = t > 0 ? 'hidden' : 'visible';\n  }),\n});\n\nconst hide = styler => t =>\n  styler.set({\n    opacity: t,\n    visibility: t > 0 ? 'visible' : 'hidden',\n  });\n\nconst diffRect = (a, b) => ({\n  translateY: a.top - b.top,\n  translateX: a.left - b.left,\n  scaleY: a.height / b.height,\n  scaleX: a.width / b.width,\n});\n\nclass Morph extends Component {\n  static propTypes = {\n    // eslint-disable-next-line\n    portalElement: propTypes.object,\n    children: propTypes.func.isRequired,\n    spring: propTypes.shape({\n      restDelta: propTypes.number,\n      restSpeed: propTypes.number,\n      stiffness: propTypes.number.isRequired,\n      mass: propTypes.number,\n      damping: propTypes.number.isRequired,\n    }),\n  };\n\n  static defaultProps = {\n    portalElement: global.document && global.document.body,\n    spring: {\n      restDelta: 0.001,\n      restSpeed: 0.001,\n      damping: 26,\n      mass: 1,\n      stiffness: 170,\n    },\n  };\n\n  state = {\n    state: 'from',\n  };\n\n  componentWillUnmount() {\n    // Remove clones.\n    this.elementsCloned.forEach(node =>\n      this.props.portalElement.removeChild(node),\n    );\n  }\n\n  elementFrom = {};\n  elementTo = {};\n\n  elementsCloned = [];\n\n  hideElements = [];\n  fadeInElements = [];\n  fadeOutElements = [];\n\n  isPlaying = false;\n  timeline = [];\n\n  hide = options => ({\n    ref: node => {\n      const element = node;\n      this.hideElements.push({ element, options });\n    },\n  });\n\n  progress = value(0, this.seek);\n\n  fadeIn = options => ({\n    ref: node => {\n      const element = node;\n      if (!element) return;\n\n      element.style.willChange = 'opacity';\n      element.style.pointerEvents = 'none';\n      element.style.opacity = 0;\n      this.fadeInElements.push({ element, options });\n    },\n  });\n\n  fadeOut = options => ({\n    ref: node => {\n      const element = node;\n      if (!element) return;\n\n      element.style.willChange = 'opacity';\n      this.fadeOutElements.push({ element, options });\n    },\n  });\n\n  from = (key, options) => ({\n    ref: node => {\n      const element = node;\n      if (!element || this.elementFrom[key]) return;\n\n      element.style.willChange = 'transform';\n      this.elementFrom[key] = { element, options };\n    },\n  });\n\n  to = (key, options) => ({\n    ref: node => {\n      const element = node;\n      if (!element || this.elementTo[key]) return;\n\n      element.style.visibility = 'hidden';\n      element.style.opacity = 0;\n      element.style.willChange = 'transform';\n      this.elementTo[key] = { element, options };\n    },\n  });\n\n  go = (to, options = {}) => {\n    if (!this.timeline.length) {\n      this.init(to);\n      return;\n    }\n\n    spring({\n      from: this.progress.get(),\n      to,\n      ...this.props.spring,\n      ...options,\n    }).start(x => {\n      this.progress.update(x);\n      this.seek(x);\n    });\n  };\n\n  seek = t => {\n    if (t === 1 || t === 0) {\n      this.setState({ state: t ? 'to' : 'from' });\n    }\n\n    this.timeline.forEach(x => x.seek(t));\n  };\n\n  /* eslint-disable max-statements */\n  morph = key => {\n    const {\n      element: original,\n      options: {\n        zIndex,\n        getMargins = true,\n        easing: optEasing = x => x,\n        ...options\n      } = {},\n    } = this.elementFrom[key];\n    const { element: target } = this.elementTo[key];\n\n    const originalRect = getBox(original, { getMargins });\n    const targetRect = getBox(target, { getMargins });\n    const originalCloneContainer = document.createElement('div');\n    const originalClone = original.cloneNode(true);\n\n    originalCloneContainer.appendChild(originalClone);\n\n    const originalStyler = css(original);\n    const cloneStyler = css(originalCloneContainer);\n    const targetStyler = css(target);\n\n    cloneStyler.set({\n      position: 'absolute',\n      transformOrigin: 'top left',\n      pointerEvents: 'none',\n      ...originalRect,\n      ...options,\n      zIndex,\n    });\n    targetStyler.set({\n      'transform-origin': 'top left',\n      visibility: 'visible',\n    });\n\n    this.props.portalElement.appendChild(originalCloneContainer);\n    this.elementsCloned = [...this.elementsCloned, originalCloneContainer];\n\n    const diffStyle = diffRect(targetRect, originalRect);\n\n    const cloneTranslateIn = interpolateObject(\n      { translateX: 0, translateY: 0, scaleX: 1, scaleY: 1 },\n      diffStyle,\n    );\n\n    const diffTargetStyles = diffRect(originalRect, targetRect);\n    const targetTranslateFLIP = interpolateObject(diffTargetStyles, {\n      translateX: 0,\n      translateY: 0,\n      scaleX: 1,\n      scaleY: 1,\n    });\n\n    this.timeline.push(\n      // In and out track.\n      {\n        seek: keyframe({\n          0.01: t => {\n            hide(originalStyler)(1 - t);\n          },\n          30: () => {},\n          100: t => {\n            hide(cloneStyler)(1 - t);\n          },\n        }),\n      },\n      // Full track.\n      {\n        seek: keyframe({\n          100: t => {\n            pipe(optEasing, cloneTranslateIn, cloneStyler.set)(t);\n            pipe(optEasing, targetTranslateFLIP, targetStyler.set)(t);\n          },\n        }),\n      },\n      // Half way track.\n      {\n        seek: keyframe({\n          0.01: t => {\n            hide(cloneStyler)(t);\n          },\n          30: t => hide(targetStyler)(t),\n        }),\n      },\n    );\n\n    this.isPlaying = true;\n  };\n\n  init = to => {\n    if (this.timeline.length) return;\n\n    Object.keys(this.elementFrom).forEach(this.morph);\n\n    const fadeOuts = this.fadeOutElements.map(fadeOutTween);\n    const fadeIns = this.fadeInElements.map(fadeInTween);\n    const hidesIns = this.hideElements.map(hideTween);\n\n    this.timeline = [...fadeOuts, ...fadeIns, ...hidesIns, ...this.timeline];\n\n    raf(() => this.go(to));\n  };\n\n  render() {\n    const renderedChildren = this.props.children({\n      from: this.from,\n      to: this.to,\n\n      fadeIn: this.fadeIn,\n      fadeOut: this.fadeOut,\n\n      back: this.back,\n      seek: this.seek,\n      go: this.go,\n\n      progress: this.progress,\n      state: this.state.state,\n\n      hide: this.hide,\n      init: this.init,\n    });\n\n    return renderedChildren && React.Children.only(renderedChildren);\n  }\n}\n\nexport default Morph;\n"]}